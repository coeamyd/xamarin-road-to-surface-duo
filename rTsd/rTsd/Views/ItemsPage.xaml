<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:d="http://xamarin.com/schemas/2014/forms/design"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:yummy="clr-namespace:Xamarin.Forms.PancakeView;assembly=Xamarin.Forms.PancakeView"
             xmlns:effects="clr-namespace:rTsd.Effects"
             mc:Ignorable="d"
             x:Class="rTsd.Views.ItemsPage"
             Title="{Binding Title}"
             Shell.NavBarIsVisible="false"
             ControlTemplate="{StaticResource BasePageControlTemplate}">

    <!-- Background gradient view -->
    <yummy:PancakeView>

        <!-- Configurate PancakeView -->
        <yummy:PancakeView.BackgroundGradientStops>
            <yummy:GradientStopCollection>
                <yummy:GradientStop Color="{StaticResource Primary}" Offset="0" />
                <yummy:GradientStop Color="{StaticResource PrimaryReduced}" Offset="0.75" />
                <yummy:GradientStop Color="{StaticResource Accent}" Offset="1" />
            </yummy:GradientStopCollection>
        </yummy:PancakeView.BackgroundGradientStops>

        <!-- CollectionView -->
        <CollectionView x:Name="ItemsCollectionView"
                        Margin="20, 10"
                        ItemsSource="{Binding Items}"
                        SelectedItem="{Binding SelectedPost, Mode=TwoWay}"
                        SelectionMode="Single"
                        SelectionChangedCommand="{Binding NavigateToDetailPageCommand}"
                        SelectionChangedCommandParameter="{Binding Source={x:Reference ItemsCollectionView}, Path=SelectedItem}">

            <!-- Configurate item layout -->
            <CollectionView.ItemsLayout>
                <LinearItemsLayout Orientation="Vertical" 
                                   ItemSpacing="20"/>
            </CollectionView.ItemsLayout>

            <!-- Configurate item template -->
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    
                    <!-- Tear view -->
                    <yummy:PancakeView HeightRequest="120"
                                       CornerRadius="20, 0, 0, 20"
                                       BorderColor="{StaticResource Primary}" 
                                       BorderThickness="1">
                        
                        <!-- Content of the item template -->
                        <Grid>
                            <!-- Background image -->
                            <Image Source="{Binding ImageSource}" 
                                   Aspect="AspectFill"/>

                            <!-- Bottom blur and title view -->
                            <yummy:PancakeView HeightRequest="60" 
                                               VerticalOptions="EndAndExpand">
                                <Grid>

                                    <!-- Todo: Add working blurred background. Android does not support blur -->
                                    <!-- Blurring background image -->
                                    <Image Source="blur_background"  
                                           Aspect="Fill"
                                           Opacity="0.5"/>

                                    <!-- Title -->
                                    <Label Text="{Binding Title}" 
                                           VerticalOptions="EndAndExpand" 
                                           LineBreakMode="TailTruncation"
                                           MaxLines="2"
                                           Margin="10, 5, 10, 5" 
                                           FontSize="19" 
                                           TextColor="{StaticResource OnPrimary}">
                                        
                                        <!-- Add shadoe effect -->
                                        <Label.Effects>
                                            <effects:ShadowEffect Radius="10"
                                                                  DistanceX="2" 
                                                                  DistanceY="2" 
                                                                  Color="Black" />
                                        </Label.Effects>
                                    </Label>
                                </Grid>
                            </yummy:PancakeView>
                        </Grid>
                    </yummy:PancakeView>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </yummy:PancakeView>
</ContentPage>